# Deploy resources using bicep
# I will create
  # Resource Group
  # Service Plan
  # App Service
  

trigger: none

variables:  
  webAppName: 'web-bicep'
  agentName: racknerdLinuxAgent
  serviceConnectionName: 'MyAzSubscription'

pool:
  name: LinuxAgent
  demands:
  - Agent.Name -equals $(agentName)

steps:
- task: AzureCLI@2
  displayName: Preview bicep
  inputs:
    azureSubscription: $(serviceConnectionName)
    scriptType: 'bash'
    scriptLocation: inlineScript
    inlineScript: |
      az group create --name $(ResourceGroupName) --location $(Location)
      az deployment group create \
        --name $(Build.BuildNumber) \        
        --resource-group $(ResourceGroupName) \
        --template-file deployment/template.bicep \
        --parameters webAppName=$(webAppName) appServicePlan=$(appServicePlan) 
